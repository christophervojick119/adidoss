#!/usr/bin/env ruby
#
# Copyright (c) 2014 Evan Phoenix
#

puts "puma-wild 111 defined?(Bundler) = #{defined?(Bundler).inspect}"
require 'rubygems'

gems = ARGV.shift

inc = ""

if gems == "-I"
  inc = ARGV.shift
  $LOAD_PATH.concat inc.split(":")
  gems = ARGV.shift
end

p gems

gems.split(",").each do |s|
  name, ver = s.split(":",2)
  gem name, ver
end

puts "puma-wild 222 defined?(Bundler) = #{defined?(Bundler).inspect}"

module Puma; end

Puma.const_set("WILD_ARGS", ["-I", inc, gems])

require 'puma/cli'

puts "puma-wild 333 defined?(Bundler) = #{defined?(Bundler).inspect}"
cli = Puma::CLI.new ARGV

cli.run
